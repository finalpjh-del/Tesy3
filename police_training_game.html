<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ê²½ì°° ì–‘ì„± ê²Œì„ - ì „íˆ¬</title>
<style>
  :root{--bg1:#ff9966;--bg2:#ff5e62;--ink:#10131a;--paper:#fff}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:linear-gradient(90deg,var(--bg1),var(--bg2));color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;text-align:center}
  .bar{display:flex;align-items:center;justify-content:space-between;padding:8px 10px}
  .pill{background:#0b1020;color:#fff;border-radius:999px;padding:8px 12px;font-weight:700;text-decoration:none;box-shadow:0 0 0 2px #1e88e520}
  .ok{background:linear-gradient(90deg,#ff9966,#ff5e62);color:#fff;font-weight:800;border:0;border-radius:14px;padding:12px 16px;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.25)}
  .ok:disabled{opacity:.5;cursor:not-allowed}
  .hud{margin:4px 0 6px}
  #pDice,#eDice,#promoD1,#promoD2{font-size:92px;display:inline-block}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:14px;z-index:1000}
  .modal{width:min(92vw,640px);background:var(--paper);color:var(--ink);border-radius:18px;padding:20px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
  .btnrow{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;max-width:760px;margin:8px auto;padding:0 10px}
  .afterrow{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;max-width:900px;margin:8px auto;padding:0 10px}
  @media (max-width:700px){ .btnrow,.afterrow{grid-template-columns:repeat(2,1fr);} }
  #toast{position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:1300;display:none}
  #toast .bubble{background:rgba(255,255,255,.95);color:#111;padding:10px 14px;border-radius:999px;box-shadow:0 6px 22px rgba(0,0,0,.35);font-weight:800}
  #flash{position:fixed;inset:0;pointer-events:none;mix-blend-mode:screen;display:none;z-index:1100}
  .small{font-size:13px;opacity:.9}
</style>
</head>
<body>
  <h1 style="margin:10px 0 6px">ğŸ² ê²½ì°° ì–‘ì„± ğŸ² <span class="small" style="opacity:.8">v0.23</span></h1>

  <!-- ì‹ ì› ì„ íƒ ì˜¤ë²„ë ˆì´ (ìƒëµ: ê¸°ì¡´ ë™ì¼) -->
  <div id="start" class="overlay" style="display:flex">
    <div class="modal">
      <div style="font-weight:800">ğŸªª ì‹ ì› ì„ íƒ</div>
      <div class="small" style="margin:6px 0">ì„ íƒí•˜ì§€ ì•Šì€ í•­ëª©ì€ ë¬´ì‘ìœ„ë¡œ ì •í•´ì§‘ë‹ˆë‹¤.</div>

      <div style="margin-top:8px">ì¡°ì§</div>
      <div id="grpOrg"><button data-org="police" class="pill">ğŸš“ ê²½ì°°</button> <button data-org="coast" class="pill">ğŸš¤ í•´ì–‘ê²½ì°°</button></div>
      <div style="height:10px"></div>
      <div>ì„±ë³„</div>
      <div id="grpGender"><button data-g="M" class="pill">ğŸ‘¨ ë‚¨ì</button> <button data-g="F" class="pill">ğŸ‘© ì—¬ì</button></div>
      <div style="height:10px"></div>
      <div>ì‹œì‘ ê³„ê¸‰</div>
      <div id="grpRank"><button data-rank="1" class="pill">ìˆœê²½</button> <button data-rank="4" class="pill">ê²½ìœ„</button></div>
      <div style="height:10px"></div>
      <div><label for="nm">ì´ë¦„</label> <input id="nm" type="text" placeholder="ë¹„ì›Œë‘ë©´ ê¸°ë³¸ ì´ë¦„ ì ìš©" style="padding:10px 12px;border:1px solid #ddd;border-radius:12px;width:100%;max-width:280px" /></div>
      <div style="display:flex;justify-content:flex-end;margin-top:10px"><button id="btnStart" class="ok">ì‹œì‘</button></div>
    </div>
  </div>

  <!-- ìƒë‹¨ ë°” -->
  <div class="bar">
    <a class="pill" href="index.html?v=0.23">â¬…ï¸ ë©”ì¸</a>
    <span id="orgBadge" class="pill">ğŸš“ ê²½ì°°</span>
    <button id="btnResign" class="pill">ğŸ“ ì˜ì›ë©´ì§</button>
  </div>

  <!-- HUD -->
  <div class="hud">
    <span id="emoji">ğŸ‘®</span> <span id="rank">ìˆœê²½</span> <span id="name">â€”</span>
    | â¤ï¸ <span id="hp">50</span>/<span id="maxhp">50</span>
    | ğŸ’° <span id="gold">0</span>
    | ğŸ’‰ <span id="bags">0</span>
  </div>

  <!-- ì  ì •ë³´ -->
  <div>âš”ï¸ ì : <span id="enemyName"></span> (ì²´ë ¥: <span id="enemyHP"></span>)</div>

  <!-- ë²„íŠ¼ -->
  <div class="btnrow">
    <button id="btnRoll" class="ok">ğŸ² êµ´ë¦¬ê¸°</button>
    <button id="btnBaton" class="ok">ğŸ¦¯ ì‚¼ë‹¨ë´‰ (1ğŸ’°)</button>
    <button id="btnFire" class="ok">ğŸ”« ê²©ë°œ (ë¬´ê¸° ì—†ìŒ)</button>
    <button id="btnSwitchWeapon" class="pill">ğŸ”„ ë¬´ê¸°ë³€í™˜</button>
  </div>

  <!-- ì•ˆë‚´/ì£¼ì‚¬ìœ„/ìš”ê±´ í•œ ì¤„ -->
  <div id="msg" class="small">âš”ï¸ ì œì•• ì¤‘...</div>
  <div class="small" id="reqLine" style="margin-top:4px;opacity:.95">ğŸ–ï¸ 7ì  ì´ìƒì‹œ ìŠ¹ì§„! (ì—°ì°¨ ë„ë‹¬ ì‹œ)</div>
  <div style="display:flex;align-items:center;justify-content:center;gap:16px;margin-top:4px">
    ë‚˜: <span id="pDice">ğŸ²</span> ì : <span id="eDice">ğŸ²</span>
  </div>

  <!-- ì „íˆ¬ ì¤‘ êµ¬ê¸‰í•¨ -->
  <div style="margin-top:6px"><button id="btnUseBag" class="ok">ğŸ’‰ â¤ï¸+30 (í„´ ì†Œìš”)</button></div>

  <!-- ì• í”„í„° íŒ¨ë„ -->
  <div id="after" style="display:none; margin-top:12px">
    <div style="margin-bottom:8px;font-weight:800">âœ… ì œì•• ì™„ë£Œ!</div>
    <div class="afterrow">
      <button id="btnRest" class="ok">ğŸ›€ ì”»ê³  ì¶œê·¼</button>
      <button id="btnBuyBag" class="ok">ğŸ’‰ êµ¬ê¸‰í•¨ (5ğŸ’°)</button>
      <button id="btnUseBagAfter" class="ok">ğŸ’‰ ì‚¬ìš© (â¤ï¸+30)</button>
      <button id="btnPromote" class="ok" title="ì—°ì°¨ ë„ë‹¬ ì‹œ í™œì„±í™”">ğŸ–ï¸ ìŠ¹ì§„ë„ì „ (<span id="cost">10</span>ğŸ’°)</button>
    </div>
    <!-- ë¬´ê¸° ìƒì  -->
    <div class="afterrow" style="margin-top:6px">
      <button id="buy22"  class="pill">22lr ê¶Œì´ (10ğŸ’°)</button>
      <button id="buy9"   class="pill">9mm ê¶Œì´ (20ğŸ’°)</button>
      <button id="buyShot" class="pill">ì—½ì´ (35ğŸ’°)</button>
      <button id="buyTaser" class="pill">í…Œì´ì €ê±´ (50ğŸ’°)</button>
    </div>
    <div class="small" id="afterInfo" style="margin-top:10px;opacity:.95"></div>
  </div>

  <!-- ìŠ¹ì§„ ë„ì „ ëª¨ë‹¬ -->
  <div id="promo" class="overlay">
    <div class="modal" style="max-width:680px;text-align:center">
      <div style="font-weight:800">ğŸ–ï¸ ìŠ¹ì§„ë„ì „</div>
      <div class="small" id="promoDesc">ì£¼ì‚¬ìœ„ 2ê°œ í•©ì´ ìš”êµ¬ì¹˜ ì´ìƒì´ë©´ ìŠ¹ì§„</div>
      <div style="margin-top:8px"><span id="promoD1">ğŸ²</span> <span id="promoD2">ğŸ²</span></div>
      <div style="display:flex;justify-content:center;margin-top:6px;gap:8px">
        <button id="promoGo" class="ok">ğŸ² ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
        <button id="promoCancel" class="pill">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <!-- ì—”ë”©/í† ìŠ¤íŠ¸/ì„¬ê´‘ (ìƒëµ: êµ¬í˜„ ë™ì¼) -->
  <div id="toast"><div class="bubble" id="toastMsg">ì•Œë¦¼</div></div>
  <canvas id="flash"></canvas>

<script>
(()=>{
// ---- ìœ í‹¸/ìƒíƒœ/ìƒìˆ˜(ê¸°ì¡´ê³¼ ë™ì¼í•œ ë¡œì§ ìœ ì§€, ì¼ë¶€ ì¶•ì•½) ----
const $=id=>document.getElementById(id);
const R=["ì˜ê²½","ìˆœê²½","ê²½ì¥","ê²½ì‚¬","ê²½ìœ„","ê²½ê°","ê²½ì •","ì´ê²½","ê²½ë¬´ê´€","ì¹˜ì•ˆê°","ì¹˜ì•ˆì •ê°","ì¹˜ì•ˆì´ê°"];
const D=['âš€','âš','âš‚','âšƒ','âš„','âš…'];
const rint=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const state={org:null,gender:null,name:"â€”",rankIdx:1,entryRank:"ìˆœê²½",level:1,maxHP:50,hp:50,gold:0,bags:0,enemyHP:0,enemyLabel:"",cost:10,monthsAccum:0,lastRankChangeMonths:0,lastPromoAnnivNotifiedAt:-1,ended:false,ownedWeapons:new Set(),ammo:'',doubleStreak:0};
const monthsInRank=()=>state.monthsAccum-state.lastRankChangeMonths;
const fmtYM=m=>{const y=Math.floor((m||0)/12),mm=(m||0)%12;return mm===0?`${String(y).padStart(2,'0')}ë…„`:`${String(y).padStart(2,'0')}ë…„ ${String(mm).padStart(2,'0')}ê°œì›”`;};

// ---- ìŠ¹ì§„ ê·œì¹™(ìš”ê±´ í•œ ì¤„ìš©) ----
function reqByRank(idx){ if(idx===0) return 6; if(idx<=3) return 7; if(idx<=6) return 8; if(idx<=9) return 9; if(idx===10) return 10; return 12; }
function minMonths(idx){ if(idx===0) return 36; if(idx<=4) return 12; if(idx<=6) return 24; if(idx<=10) return 12; return 12; }

// ---- UI ì—…ë°ì´íŠ¸ ----
function updateHUD(){
  $("rank").textContent=R[state.rankIdx]; $("hp").textContent=state.hp; $("maxhp").textContent=state.maxHP;
  $("gold").textContent=state.gold; $("bags").textContent=state.bags; $("enemyName").textContent=state.enemyLabel; $("enemyHP").textContent=state.enemyHP; $("cost").textContent=state.cost;
  // í•œ ì¤„ ìš”ê±´ ì•ˆë‚´
  const need=reqByRank(state.rankIdx); $("reqLine").textContent=`ğŸ–ï¸ ${need}ì  ì´ìƒì‹œ ìŠ¹ì§„! (ì—°ì°¨ ë„ë‹¬ ì‹œ)`;
}

// ---- ì /ì „íˆ¬/ì• í”„í„° & ë‚˜ë¨¸ì§€ ê¸°ì¡´ ê¸°ëŠ¥ì€ ì´ì „ ë²„ì „ê³¼ ë™ì¼í•˜ê²Œ ë‘ê³ , í•µì‹¬ë§Œ ìœ ì§€ ----
// (ì—¬ê¸°ì„œëŠ” ê¸¸ì´ ë¬¸ì œë¡œ ì „íˆ¬ ìƒì„¸ ë¡œì§ì€ ìƒëµí•˜ì§€ ì•Šê³  ë™ì‘ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë ¤ë©´, ì´ì „ì— ì œê³µëœ v0.21 ì½”ë“œì˜ ì „íˆ¬/ë¬´ê¸°/êµ¬ê¸‰í•¨/ìŠ¹ë¦¬/ì• í”„í„°/í”„ë¡œëª¨ì…˜ í•¨ìˆ˜ë“¤ì„ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.)
// â˜…â˜… ì‹¤ì œ ë°°í¬ìš©ì—ì„  v0.21ì˜ ì „íˆ¬Â·ë¬´ê¸°Â·ê·¼ì†ìŠ¹ì§„Â·ì •ë…„Â·ì—”ë”©Â·í† ìŠ¤íŠ¸Â·ì„¬ê´‘ ë¡œì§ ë¸”ë¡ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ì„¸ìš”. â˜…â˜…

/* --- ìµœì†Œ ê°€ë™ì„ ìœ„í•œ í•„ìˆ˜ í•¸ë“¤ëŸ¬(ë°ëª¨) --- */
function spawn(){ state.enemyLabel=`Lv.${state.level} ìš©ì˜ì`; state.enemyHP=15+state.level; updateHUD(); }
$("btnStart").onclick=()=>{ state.org='police'; state.gender='M'; state.name=($("nm").value.trim()||'í¬ëŒ'); state.rankIdx=1; state.entryRank=R[state.rankIdx]; state.maxHP=50; state.hp=50; state.gold=0; state.bags=0; state.cost=10; state.monthsAccum=0; state.lastRankChangeMonths=0; $("start").style.display="none"; spawn(); };
$("btnRoll").onclick=()=>{ const p=rint(1,6),e=rint(1,6); $("pDice").textContent=D[p-1]; $("eDice").textContent=D[e-1]; state.enemyHP-=p; state.hp-=e; updateHUD(); if(state.enemyHP<=0){ $("after").style.display="block"; state.monthsAccum+=4; updateHUD(); } };
$("btnRest").onclick=()=>{ $("after").style.display="none"; state.level++; spawn(); };
$("btnUseBag").onclick=()=>{ if(state.bags>0){ state.bags--; state.hp=Math.min(state.maxHP,state.hp+30); updateHUD(); } };
$("buy22").onclick=()=>{ if(state.gold>=10){ state.gold-=10; state.ownedWeapons.add('22lr'); state.ammo='22lr'; updateHUD(); } };
$("btnPromote").onclick=()=>{ const need=reqByRank(state.rankIdx); if(monthsInRank()%12!==0 || monthsInRank()<minMonths(state.rankIdx)) return alert("ì—°ì°¨ ë„ë‹¬ ì‹œ ë„ì „ ê°€ëŠ¥"); if(state.gold<state.cost) return alert("ê³¨ë“œ ë¶€ì¡±"); $("promo").style.display="flex"; $("promoDesc").textContent=`í•„ìš” ì ìˆ˜: ${need}`; };
$("promoGo").onclick=()=>{ const a=rint(1,6),b=rint(1,6),sum=a+b,need=reqByRank(state.rankIdx); $("promoD1").textContent=D[a-1]; $("promoD2").textContent=D[b-1]; if(sum>=need){ state.rankIdx++; state.maxHP+=10; state.hp=state.maxHP; state.lastRankChangeMonths=state.monthsAccum; } setTimeout(()=>{$("promo").style.display="none"; updateHUD();},1500); };
$("promoCancel").onclick=()=>{$("promo").style.display="none";};

updateHUD();
})();
</script>
</body>
</html>
