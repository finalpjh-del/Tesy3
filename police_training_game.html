<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ê²½ì°° ì–‘ì„± ê²Œì„ - ì „íˆ¬</title>
<style>
:root{--bg1:#ff9966;--bg2:#ff5e62;--ink:#10131a;--paper:#fff}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:linear-gradient(90deg,var(--bg1),var(--bg2));color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;text-align:center}
.bar{display:flex;align-items:center;justify-content:space-between;padding:8px 10px}
.pill{background:#0b1020;color:#fff;border-radius:999px;padding:8px 12px;font-weight:700;text-decoration:none;box-shadow:0 0 0 2px #1e88e520}
.ok{background:linear-gradient(90deg,#ff9966,#ff5e62);color:#fff;font-weight:800;border:0;border-radius:14px;padding:12px 16px;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.25)}
.ok:disabled{opacity:.5;cursor:not-allowed}
.hud{margin:4px 0 6px}
#pDice,#eDice{font-size:92px;display:inline-block}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:14px;z-index:1000}
.modal{width:min(92vw,680px);background:var(--paper);color:var(--ink);border-radius:18px;padding:20px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
.group .pill{margin:4px} .pill.active{outline:3px solid #ff9966}
.btnrow{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;max-width:760px;margin:8px auto;padding:0 10px}
.afterrow{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;max-width:900px;margin:8px auto;padding:0 10px}
@media (max-width:700px){ .btnrow,.afterrow{grid-template-columns:repeat(2,1fr);} }
.small{font-size:13px;opacity:.95}
#toast{position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:1300;display:none}
#toast .bubble{background:rgba(255,255,255,.95);color:#111;padding:10px 14px;border-radius:999px;box-shadow:0 6px 22px rgba(0,0,0,.35);font-weight:800}
#diss{position:fixed;inset:0;pointer-events:none;background:#fff;opacity:0;transition:opacity 3s;z-index:1200}
</style>
</head>
<body>
<h1 style="margin:10px 0 6px">ğŸ² ê²½ì°° ì–‘ì„± ğŸ² <span class="small" style="opacity:.8">v0.26</span></h1>

<!-- ì‹ ì› ì„ íƒ -->
<div id="start" class="overlay" style="display:flex">
  <div class="modal">
    <div style="font-weight:800">ğŸªª ì‹ ì› ì„ íƒ</div>
    <div class="small" style="margin:6px 0">ì„ íƒí•˜ì§€ ì•Šì€ í•­ëª©ì€ ë¬´ì‘ìœ„ë¡œ ì •í•´ì§‘ë‹ˆë‹¤.</div>

    <div class="group"><div style="margin-top:8px">ì¡°ì§</div>
      <button class="pill selOrg" data-val="police">ğŸš“ ê²½ì°°</button>
      <button class="pill selOrg" data-val="coast">ğŸš¤ í•´ì–‘ê²½ì°°</button>
    </div>
    <div class="group"><div style="margin-top:8px">ì„±ë³„</div>
      <button class="pill selGen" data-val="M">ğŸ‘¨ ë‚¨ì</button>
      <button class="pill selGen" data-val="F">ğŸ‘© ì—¬ì</button>
    </div>
    <div class="group"><div style="margin-top:8px">ì‹œì‘ ê³„ê¸‰</div>
      <button class="pill selRank" data-val="0">ì˜ê²½</button>
      <button class="pill selRank" data-val="1">ìˆœê²½</button>
    </div>

    <div style="margin-top:8px"><label for="nm">ì´ë¦„</label>
      <input id="nm" type="text" placeholder="ë¹„ì›Œë‘ë©´ ìë™ ì´ë¦„" style="padding:10px 12px;border:1px solid #ddd;border-radius:12px;width:100%;max-width:280px"></div>

    <div style="display:flex;justify-content:flex-end;margin-top:10px"><button id="btnStart" class="ok">ì‹œì‘</button></div>
  </div>
</div>

<!-- ìƒë‹¨ ë°” -->
<div class="bar">
  <a class="pill" href="index.html?v=0.26">â¬…ï¸ ë©”ì¸</a>
  <span id="orgBadge" class="pill">ğŸš“ ê²½ì°°</span>
  <button id="btnResign" class="pill">ğŸ“ ì˜ì›ë©´ì§</button>
</div>

<!-- HUD -->
<div class="hud">
  <span id="emoji">ğŸ‘®</span> <span id="rank">ìˆœê²½</span> <span id="name">â€”</span>
  | â¤ï¸ <span id="hp">50</span>/<span id="maxhp">50</span>
  | ğŸ’° <span id="gold">0</span>
  | ğŸ’‰ <span id="bags">0</span>
  | ğŸ”« <span id="weapon">ë¬´ê¸°ì—†ìŒ</span>
</div>

<!-- ì  ì •ë³´ -->
<div>âš”ï¸ ì : <span id="enemyName"></span> (ì²´ë ¥: <span id="enemyHP"></span>)</div>

<!-- ì „íˆ¬ ë²„íŠ¼ -->
<div class="btnrow">
  <button id="btnRoll" class="ok">ğŸ² êµ´ë¦¬ê¸°</button>
  <button id="btnBaton" class="ok">ğŸ¦¯ ì‚¼ë‹¨ë´‰ (1ğŸ’°)</button>
  <button id="btnFire" class="ok">ğŸ”« ê²©ë°œ</button>
  <button id="btnSwitchWeapon" class="pill">ğŸ”„ ë¬´ê¸°ë³€í™˜</button>
</div>

<!-- ì „íˆ¬ ì¤‘ êµ¬ê¸‰í•¨ -->
<div style="margin-top:6px"><button id="btnUseBag" class="ok">ğŸ’‰ â¤ï¸+30 (í„´ ì†Œìš”)</button></div>

<!-- ì• í”„í„° íŒ¨ë„ -->
<div id="after" style="display:none; margin-top:12px">
  <div style="margin-bottom:8px;font-weight:800">âœ… ì œì•• ì™„ë£Œ!</div>
  <div class="afterrow">
    <button id="btnRest" class="ok">ğŸ›€ ì”»ê³  ì¶œê·¼</button>
    <button id="btnBuyBag" class="ok">ğŸ’‰ êµ¬ê¸‰í•¨ (5ğŸ’°)</button>
    <button id="btnUseBagAfter" class="ok">ğŸ’‰ ì‚¬ìš© (â¤ï¸+30)</button>
    <button id="btnPromote" class="ok" title="ì—°ì°¨ ë„ë‹¬ ì‹œ í™œì„±í™”">ğŸ–ï¸ ìŠ¹ì§„ë„ì „ (10ğŸ’°)</button>
  </div>
  <!-- ë¬´ê¸°êµ¬ì… íŒ¨ë„ ë³µêµ¬ -->
  <div class="afterrow" style="margin-top:6px">
    <button id="buy22"  class="pill">22lr ê¶Œì´ (10ğŸ’°)</button>
    <button id="buy9"   class="pill">9mm ê¶Œì´ (20ğŸ’°)</button>
    <button id="buyShot" class="pill">ì—½ì´ (35ğŸ’°)</button>
    <button id="buyTaser" class="pill">í…Œì´ì €ê±´ (50ğŸ’°)</button>
  </div>
</div>

<!-- ìŠ¹ì§„ ë„ì „ ëª¨ë‹¬ (í•„ìš” ì ìˆ˜ í‘œê¸°) -->
<div id="promo" class="overlay">
  <div class="modal" style="max-width:680px;text-align:center">
    <div style="font-weight:800">ğŸ–ï¸ ìŠ¹ì§„ë„ì „</div>
    <div class="small" id="promoNeed" style="margin-top:6px">í•„ìš” ì ìˆ˜: 7 ì´ìƒ</div>
    <div style="margin-top:8px"><span id="pd1" style="font-size:92px">ğŸ²</span> <span id="pd2" style="font-size:92px">ğŸ²</span></div>
    <div id="presult" class="small" style="height:22px;margin-top:6px"></div>
    <div style="display:flex;justify-content:center;margin-top:8px;gap:8px">
      <button id="promoGo" class="ok">ğŸ² ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
      <button id="promoClose" class="pill" disabled>ë‹«ê¸°</button>
    </div>
  </div>
</div>

<!-- í† ìŠ¤íŠ¸ & ë””ì¡¸ë¸Œ -->
<div id="toast"><div class="bubble" id="toastMsg">ì•Œë¦¼</div></div>
<div id="diss"></div>

<script>
(()=>{
// ====== ê³µí†µ ======
const $=id=>document.getElementById(id);
const D=['âš€','âš','âš‚','âšƒ','âš„','âš…'];
const R=["ì˜ê²½","ìˆœê²½","ê²½ì¥","ê²½ì‚¬","ê²½ìœ„","ê²½ê°","ê²½ì •","ì´ê²½","ê²½ë¬´ê´€","ì¹˜ì•ˆê°","ì¹˜ì•ˆì •ê°","ì¹˜ì•ˆì´ê°"];
const rint=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;

// ====== ìƒíƒœ ======
const state={
  org:"police", gender:"M", name:"â€”",
  rankIdx:1, entryRank:"ìˆœê²½",
  maxHP:50, hp:50, gold:0, bags:0,
  level:1, enemyHP:0, enemyLabel:"",
  monthsAccum:0, rankMonths:Array(R.length).fill(0),
  rolling:false, toasting:false, toastQ:[],
  weapon:null, // '22lr'|'9mm'|'shot'|'taser'|null
  promoLockedUntilNextAnniv:false
};

// ====== ê·œì¹™(ìš”ê±´/ì—°ì°¨) ======
const reqByRank=i=> i===0?6 : i<=3?7 : i<=6?8 : i<=9?9 : i===10?10 : 12;
const minMonths=i=> i===0?36 : i<=4?12 : i<=6?24 : i<=10?12 : 12; // ì˜ê²½3y, ìˆœê²½~ê²½ìœ„1y, ê²½ê°~ê²½ì •2y
const monthsInCurrentRank=()=>state.rankMonths[state.rankIdx];

// ====== í† ìŠ¤íŠ¸(2ì´ˆ í) ======
function pushToast(msg){ state.toastQ.push(msg); runToast(); }
function runToast(){
  if(state.toasting || state.toastQ.length===0) return;
  state.toasting=true;
  const m=state.toastQ.shift();
  $("toastMsg").textContent=m; $("toast").style.display="block";
  setTimeout(()=>{ $("toast").style.display="none"; state.toasting=false; runToast(); }, 2000);
}

// ====== ì €ì¥(ëª…ì˜ˆÂ·ì¶”ëª¨ê´€) ======
function saveToMemorial(payload){
  try{
    const key="police_memorials";
    const arr=JSON.parse(localStorage.getItem(key)||"[]");
    payload.id=Date.now();
    arr.push(payload);
    localStorage.setItem(key, JSON.stringify(arr));
  }catch(e){}
}

// ====== ì—”ë”©(ìˆœì§: 3ì´ˆ ë””ì¡¸ë¸Œ í›„) ======
function showFallenEnding(){
  const d=$("diss"); d.style.opacity=1;
  // 1ê³„ê¸‰ íŠ¹ì§„
  const beforeRank = state.rankIdx;
  const afterRank = Math.min(R.length-1, state.rankIdx+1);
  setTimeout(()=>{
    d.style.opacity=0;
    alert(`ğŸ•¯ ìˆœì§\n\n${state.name}ë‹˜ì€ ì„ë¬´ ì¤‘ ìˆœì§í–ˆìŠµë‹ˆë‹¤.\n"ìˆœì§ìœ¼ë¡œ ì¸í•œ 1ê³„ê¸‰ íŠ¹ì§„" (${R[beforeRank]} â†’ ${R[afterRank]})`);
    // ì¶”ëª¨ê´€ ì €ì¥
    saveToMemorial({
      name: state.name,
      gender: state.gender,
      org: state.org==='coast'?'í•´ì–‘ê²½ì°°':'ê²½ì°°',
      entryRank: state.entryRank,
      currentRank: R[afterRank],
      endTitle: "ìˆœì§",
      startDate: new Date().toISOString(), // ì‹œì‘ì¼ì„ ì¶”ì í–ˆë‹¤ë©´ ê·¸ ê°’ì„ ì‚¬ìš©
      months: state.monthsAccum,
      finalGold: state.gold,
      achievements: [],
      changeLog: [`ìˆœì§ìœ¼ë¡œ ì¸í•œ 1ê³„ê¸‰ íŠ¹ì§„: ${R[beforeRank]} â†’ ${R[afterRank]}`],
      defeated: {}
    });
    // ë¦¬ì…‹ ë˜ëŠ” ë©”ì¸ìœ¼ë¡œ
    location.href="honor_memorial.html?v=0.26";
  },3000);
}

// ====== ì‹ ì› ì„ íƒ ======
const markActive=(cls,el)=>{ document.querySelectorAll('.'+cls).forEach(b=>b.classList.remove('active')); el.classList.add('active'); };
document.querySelectorAll('.selOrg').forEach(b=>b.addEventListener('click',()=>{state.org=b.dataset.val;markActive('selOrg',b);}));
document.querySelectorAll('.selGen').forEach(b=>b.addEventListener('click',()=>{state.gender=b.dataset.val;markActive('selGen',b);}));
document.querySelectorAll('.selRank').forEach(b=>b.addEventListener('click',()=>{state.rankIdx=parseInt(b.dataset.val,10); state.entryRank=R[state.rankIdx]; markActive('selRank',b);}));

$("btnStart").onclick=()=>{
  if(!document.querySelector('.selOrg.active')){ state.org=(rint(0,1)?'police':'coast'); }
  if(!document.querySelector('.selGen.active')){ state.gender=(rint(0,1)?'M':'F'); }
  if(!document.querySelector('.selRank.active')){ state.rankIdx=1; state.entryRank=R[1]; }
  state.name = ($("nm").value.trim() || (state.gender==='F'?'ë¯¼ê²½':'í¬ëŒ'));
  // ì´ˆê¸°í™”
  state.maxHP=50; state.hp=50; state.gold=0; state.bags=0;
  state.level=1; state.monthsAccum=0; state.rankMonths=Array(R.length).fill(0);
  state.weapon=null;
  $("start").style.display="none";
  spawn(); updateHUD();
};

// ====== ì „íˆ¬/ì  ======
function spawn(){ state.enemyLabel=`Lv.${state.level} ìš©ì˜ì`; state.enemyHP=15 + state.level*2; }
function updateHUD(){
  $("rank").textContent=R[state.rankIdx];
  $("name").textContent=state.name;
  $("emoji").textContent=state.gender==='F'?'ğŸ‘®â€â™€ï¸':'ğŸ‘®â€â™‚ï¸';
  $("orgBadge").textContent = state.org==='coast'?'ğŸš¤ í•´ì–‘ê²½ì°°':'ğŸš“ ê²½ì°°';
  $("hp").textContent=state.hp; $("maxhp").textContent=state.maxHP;
  $("gold").textContent=state.gold; $("bags").textContent=state.bags;
  $("weapon").textContent=state.weapon?state.weapon.toUpperCase():'ë¬´ê¸°ì—†ìŒ';
  $("enemyName").textContent=state.enemyLabel; $("enemyHP").textContent=state.enemyHP;
  const inBattle = state.enemyHP>0 && $("after").style.display!=="block";
  ["btnRoll","btnBaton","btnFire","btnUseBag","btnSwitchWeapon"].forEach(id=>$(id).disabled = !inBattle || state.rolling);
  // ìŠ¹ì§„ ë²„íŠ¼: ì—°ì°¨ & ì ê¸ˆ & ë¹„ìš©
  const need=reqByRank(state.rankIdx);
  const m=monthsInCurrentRank(); const okYear = m>=minMonths(state.rankIdx) && m%12===0;
  $("btnPromote").disabled = !(okYear && !state.promoLockedUntilNextAnniv && state.gold>=10);
}

// ì£¼ì‚¬ìœ„ ì• ë‹ˆë©”ì´ì…˜(0.5s)
function rollDiceAnim(done){
  if(state.rolling) return;
  state.rolling=true; updateHUD();
  let t=0; const iv=setInterval(()=>{
    $("pDice").textContent=D[rint(1,6)-1]; $("eDice").textContent=D[rint(1,6)-1];
    t+=80; if(t>=480){ clearInterval(iv); const p=rint(1,6), e=rint(1,6);
      $("pDice").textContent=D[p-1]; $("eDice").textContent=D[e-1];
      state.rolling=false; done(p,e);
    }
  },80);
}

// í•œ í„´ ì¢…ë£Œ í›„ í† ìŠ¤íŠ¸
function endTurnToasts({bRes,reward}){
  if(bRes) pushToast(`ğŸ¦¯ ì‚¼ë‹¨ë´‰: ì£¼ì‚¬ìœ„ ${bRes.p} Ã—2 = ${bRes.dmg} í”¼í•´`);
  if(reward) pushToast(`ğŸ… ì œì•• ë³´ìƒ: +${reward}ğŸ’°`);
}

// HP ì²´í¬ â†’ ìˆœì§ ì—”ë”©
function checkDeath(){
  if(state.hp<=0){ showFallenEnding(); return true; }
  return false;
}

// ====== ë²„íŠ¼ ======
$("btnRoll").onclick=()=>{
  if(state.enemyHP<=0 || $("after").style.display==="block") return;
  rollDiceAnim((p,e)=>{
    state.enemyHP=Math.max(0,state.enemyHP-p);
    state.hp=Math.max(0,state.hp-e);
    if(checkDeath()) return;
    if(state.enemyHP<=0){
      const reward = 5 + state.level;
      state.gold += reward;
      endTurnToasts({reward});
      $("after").style.display="block";
      state.level++;
      state.monthsAccum+=4;
      state.rankMonths[state.rankIdx]+=4;
    }
    updateHUD();
  });
};

$("btnBaton").onclick=()=>{
  if(state.enemyHP<=0) return; if(state.gold<1) return;
  state.gold--;
  rollDiceAnim((p,e)=>{
    const dmg=p*2;
    state.enemyHP=Math.max(0, state.enemyHP - dmg);
    state.hp=Math.max(0, state.hp - e);
    if(checkDeath()) return;
    if(state.enemyHP<=0){
      const reward = 5 + state.level;
      state.gold += reward;
      endTurnToasts({bRes:{p,dmg},reward});
      $("after").style.display="block";
      state.level++;
      state.monthsAccum+=4;
      state.rankMonths[state.rankIdx]+=4;
    }else{
      endTurnToasts({bRes:{p,dmg}});
    }
    updateHUD();
  });
};

$("btnUseBag").onclick=()=>{
  if(state.bags<=0 || state.hp===state.maxHP || state.enemyHP<=0) return;
  state.bags--; state.hp=Math.min(state.maxHP, state.hp+30);
  // í„´ ì†Œìš”: ì ë§Œ ì£¼ì‚¬ìœ„
  rollDiceAnim((_,e)=>{
    state.hp=Math.max(0,state.hp-e);
    if(checkDeath()) return;
    updateHUD();
  });
};

// ê²©ë°œ(ê°„ë‹¨ ë²„ì „: ë¬´ê¸°ë³„ ëª…ì¤‘ë¥ /ë°ë¯¸ì§€/ë¹„ìš©)
const WEAPONS = {
  "22lr": {cost:3, hit:0.75, dmg:[20,30]},
  "9mm":  {cost:4, hit:0.70, dmg:[25,40]},
  "shot": {cost:6, hit:0.60, dmg:[40,60]},
  "taser":{cost:10,hit:0.20, special:"kill"} // 20% ì¦‰ì‹œ ì œì••
};
$("btnFire").onclick=()=>{
  if(state.enemyHP<=0) return;
  if(!state.weapon){ pushToast("ğŸ”« ë¬´ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤. ì• í”„í„°ì—ì„œ êµ¬ë§¤í•˜ì„¸ìš”."); return; }
  const w=WEAPONS[state.weapon];
  if(state.gold<w.cost){ pushToast("ğŸ’¸ ê³¨ë“œ ë¶€ì¡±"); return; }
  state.gold-=w.cost;
  // í„´ ê³µìœ : ë‚˜/ì  ë™ì‹œì— ì£¼ì‚¬ìœ„ 1íšŒ
  rollDiceAnim((p,e)=>{
    if(w.special==="kill"){ if(Math.random()<w.hit){ state.enemyHP=0; } }
    else {
      if(Math.random()<w.hit){
        const dmg=rint(w.dmg[0],w.dmg[1]);
        state.enemyHP=Math.max(0,state.enemyHP-dmg);
        pushToast(`ğŸ”« ê²©ë°œ ì ì¤‘! -${dmg}`);
      }else{
        pushToast("ğŸ”« ë¹—ë‚˜ê°");
      }
    }
    state.hp=Math.max(0,state.hp-e);
    if(checkDeath()) return;
    if(state.enemyHP<=0){
      const reward = 5 + state.level;
      state.gold += reward;
      endTurnToasts({reward});
      $("after").style.display="block";
      state.level++;
      state.monthsAccum+=4;
      state.rankMonths[state.rankIdx]+=4;
    }
    updateHUD();
  });
};

// ë¬´ê¸° ë³€í™˜(ì†Œìœ  ì¤‘ì¼ ë•Œë§Œ ìˆœí™˜)
$("btnSwitchWeapon").onclick=()=>{
  const owned = Object.keys(WEAPONS).filter(k=>state[`own_${k}`]);
  if(owned.length===0){ pushToast("ğŸ”„ ë³´ìœ  ë¬´ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
  if(!state.weapon){ state.weapon=owned[0]; }
  else{
    const idx=owned.indexOf(state.weapon);
    state.weapon=owned[(idx+1)%owned.length];
  }
  updateHUD();
};

// ì• í”„í„° íŒ¨ë„
$("btnRest").onclick=()=>{
  $("after").style.display="none";
  spawn(); updateHUD();
};
$("btnBuyBag").onclick=()=>{ if(state.gold>=5){ state.gold-=5; state.bags++; updateHUD(); } };
$("btnUseBagAfter").onclick=()=>{ if(state.bags>0 && state.hp<state.maxHP){ state.bags--; state.hp=Math.min(state.maxHP,state.hp+30); updateHUD(); } };
// ë¬´ê¸°êµ¬ì… ë³µêµ¬
$("buy22").onclick=()=>{ if(state.gold>=10){ state.gold-=10; state.own_22lr=true; state.weapon=state.weapon||'22lr'; updateHUD(); } };
$("buy9").onclick=()=>{ if(state.gold>=20){ state.gold-=20; state.own_9mm=true; state.weapon=state.weapon||'9mm'; updateHUD(); } };
$("buyShot").onclick=()=>{ if(state.gold>=35){ state.gold-=35; state.own_shot=true; state.weapon=state.weapon||'shot'; updateHUD(); } };
$("buyTaser").onclick=()=>{ if(state.gold>=50){ state.gold-=50; state.own_taser=true; state.weapon=state.weapon||'taser'; updateHUD(); } };

// ìŠ¹ì§„ ë„ì „(ëª¨ë‹¬ì—ì„œ í•„ìš”ì ìˆ˜ í‘œê¸°, ì‹œë„ í›„ ì´ë²ˆ ì—°ì°¨ ë¹„í™œì„±í™”)
$("btnPromote").onclick=()=>{
  const need=reqByRank(state.rankIdx);
  const m=monthsInCurrentRank();
  const okYear = m>=minMonths(state.rankIdx) && m%12===0;
  if(!okYear || state.gold<10 || state.promoLockedUntilNextAnniv) return;
  $("promo").style.display="flex";
  $("promoNeed").textContent=`í•„ìš” ì ìˆ˜: ${need} ì´ìƒ`;
  $("presult").textContent=""; $("promoClose").disabled=true; $("promoGo").disabled=false;
  setTimeout(()=>{$("promoClose").disabled=false;},2000);

  $("promoGo").onclick=()=>{
    $("promoGo").disabled=true;
    const a=rint(1,6), b=rint(1,6), sum=a+b;
    $("pd1").textContent=D[a-1]; $("pd2").textContent=D[b-1];
    state.gold-=10;
    if(sum>=need){
      state.rankIdx=Math.min(R.length-1, state.rankIdx+1);
      state.maxHP+=10; state.hp=state.maxHP;
      // ìƒˆ ê³„ê¸‰ ê·¼ë¬´ê°œì›”ì€ 0ë¶€í„°
      // ì´ì „ ê³„ê¸‰ ì¹´ìš´í„°ëŠ” ê·¸ëŒ€ë¡œ(í†µê³„ìš©), í˜„ rankIdx ì¹´ìš´í„°ëŠ” ì´í›„ +4ê°œì›” ë•Œ ì¦ê°€
      pushToast(`âœ… ìŠ¹ì§„ ì„±ê³µ! (í•„ìš” ${need}, ë‹¹ì‹  ${sum})`);
    }else{
      pushToast(`âŒ ìŠ¹ì§„ ì‹¤íŒ¨â€¦ (í•„ìš” ${need}, ë‹¹ì‹  ${sum})`);
    }
    state.promoLockedUntilNextAnniv=true;  // ì´ë²ˆ ì—°ì°¨ ì ê¸ˆ(ë²„íŠ¼ ë¹„í™œì„±í™” íš¨ê³¼ ê°•í™”)
    updateHUD();
  };
};
$("promoClose").onclick=()=>{ $("promo").style.display="none"; };

// ì˜ì›ë©´ì§(ê°„ë‹¨ ì²˜ë¦¬: ì—”ë”© ì €ì¥ í›„ ì¶”ëª¨ê´€ ì´ë™)
$("btnResign").onclick=()=>{
  if(!confirm("ì˜ì›ë©´ì§ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
  saveToMemorial({
    name: state.name,
    gender: state.gender,
    org: state.org==='coast'?'í•´ì–‘ê²½ì°°':'ê²½ì°°',
    entryRank: state.entryRank,
    currentRank: R[state.rankIdx],
    endTitle: "ì˜ì›ë©´ì§",
    startDate: new Date().toISOString(),
    months: state.monthsAccum,
    finalGold: state.gold,
    achievements: [],
    changeLog: ["ì˜ì›ë©´ì§"],
    defeated: {}
  });
  location.href="honor_memorial.html?v=0.26";
};

// ì´ˆê¸°
$("start").style.display="flex";
spawn(); updateHUD();
})();
</script>
</body>
</html>
