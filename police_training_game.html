<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ê²½ì°° ì–‘ì„± ê²Œì„ - ì „íˆ¬</title>
<style>
:root{--bg1:#ff9966;--bg2:#ff5e62;--ink:#10131a;--paper:#fff}
*{box-sizing:border-box}html,body{height:100%}
body{margin:0;background:linear-gradient(90deg,var(--bg1),var(--bg2));color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;text-align:center}
.bar{display:flex;align-items:center;justify-content:space-between;padding:8px 10px}
.pill{background:#0b1020;color:#fff;border-radius:999px;padding:8px 12px;font-weight:700;text-decoration:none;box-shadow:0 0 0 2px #1e88e520}
.ok{background:linear-gradient(90deg,#ff9966,#ff5e62);color:#fff;font-weight:800;border:0;border-radius:14px;padding:12px 16px;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.25)}
.ok:disabled{opacity:.5;cursor:not-allowed}
.hud{margin:4px 0 6px}
#pDice,#eDice{font-size:92px;display:inline-block}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:14px;z-index:1000}
.modal{width:min(92vw,680px);background:var(--paper);color:var(--ink);border-radius:18px;padding:20px;box-shadow:0 18px 50px rgba(0,0,0,.35)}
.group .pill{margin:4px} .pill.active{outline:3px solid #ff9966}
.btnrow{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;max-width:760px;margin:8px auto;padding:0 10px}
.afterrow{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;max-width:900px;margin:8px auto;padding:0 10px}
@media (max-width:700px){ .btnrow,.afterrow{grid-template-columns:repeat(2,1fr);} }
.small{font-size:13px;opacity:.95}
#toast{position:fixed;top:14px;left:50%;transform:translateX(-50%);z-index:1300;display:none}
#toast .bubble{background:rgba(255,255,255,.95);color:#111;padding:10px 14px;border-radius:999px;box-shadow:0 6px 22px rgba(0,0,0,.35);font-weight:800}
#diss{position:fixed;inset:0;pointer-events:none;background:#fff;opacity:0;transition:opacity 3s;z-index:1200}
</style>
</head>
<body>
<h1 style="margin:10px 0 6px">ğŸ² ê²½ì°° ì–‘ì„± ğŸ² <span class="small" style="opacity:.8">v0.25</span></h1>

<!-- ì‹ ì› ì„ íƒ -->
<div id="start" class="overlay" style="display:flex">
  <div class="modal">
    <div style="font-weight:800">ğŸªª ì‹ ì› ì„ íƒ</div>
    <div class="small" style="margin:6px 0">ì„ íƒí•˜ì§€ ì•Šì€ í•­ëª©ì€ ë¬´ì‘ìœ„ë¡œ ì •í•´ì§‘ë‹ˆë‹¤.</div>

    <div class="group"><div style="margin-top:8px">ì¡°ì§</div>
      <button class="pill selOrg" data-val="police">ğŸš“ ê²½ì°°</button>
      <button class="pill selOrg" data-val="coast">ğŸš¤ í•´ì–‘ê²½ì°°</button>
    </div>
    <div class="group"><div style="margin-top:8px">ì„±ë³„</div>
      <button class="pill selGen" data-val="M">ğŸ‘¨ ë‚¨ì</button>
      <button class="pill selGen" data-val="F">ğŸ‘© ì—¬ì</button>
    </div>
    <div class="group"><div style="margin-top:8px">ì‹œì‘ ê³„ê¸‰</div>
      <button class="pill selRank" data-val="0">ì˜ê²½</button>
      <button class="pill selRank" data-val="1">ìˆœê²½</button>
    </div>

    <div style="margin-top:8px"><label for="nm">ì´ë¦„</label>
      <input id="nm" type="text" placeholder="ë¹„ì›Œë‘ë©´ ìë™ ì´ë¦„" style="padding:10px 12px;border:1px solid #ddd;border-radius:12px;width:100%;max-width:280px"></div>

    <div style="display:flex;justify-content:flex-end;margin-top:10px"><button id="btnStart" class="ok">ì‹œì‘</button></div>
  </div>
</div>

<!-- ìƒë‹¨ ë°” -->
<div class="bar">
  <a class="pill" href="index.html?v=0.25">â¬…ï¸ ë©”ì¸</a>
  <span id="orgBadge" class="pill">ğŸš“ ê²½ì°°</span>
  <span class="pill">ë²„ì „ v0.25</span>
</div>

<!-- HUD -->
<div class="hud">
  <span id="emoji">ğŸ‘®</span> <span id="rank">ìˆœê²½</span> <span id="name">â€”</span>
  | â¤ï¸ <span id="hp">50</span>/<span id="maxhp">50</span>
  | ğŸ’° <span id="gold">0</span>
  | ğŸ’‰ <span id="bags">0</span>
</div>

<!-- ì  ì •ë³´ -->
<div>âš”ï¸ ì : <span id="enemyName"></span> (ì²´ë ¥: <span id="enemyHP"></span>)</div>

<!-- ì „íˆ¬ ë²„íŠ¼ -->
<div class="btnrow">
  <button id="btnRoll" class="ok">ğŸ² êµ´ë¦¬ê¸°</button>
  <button id="btnBaton" class="ok">ğŸ¦¯ ì‚¼ë‹¨ë´‰ (1ğŸ’°)</button>
  <button id="btnFire" class="ok">ğŸ”« ê²©ë°œ (ì¤€ë¹„ì¤‘)</button>
  <button id="btnUseBag" class="ok">ğŸ’‰ â¤ï¸+30 (í„´ ì†Œìš”)</button>
</div>

<!-- ìš”ê±´ í•œ ì¤„ ì•ˆë‚´ -->
<div id="reqLine" class="small" style="margin-top:4px">ğŸ–ï¸ 7ì  ì´ìƒì‹œ ìŠ¹ì§„! (ì—°ì°¨ ë„ë‹¬ ì‹œ)</div>

<!-- ì£¼ì‚¬ìœ„ ì˜ì—­ -->
<div style="display:flex;align-items:center;justify-content:center;gap:16px;margin-top:4px">
  ë‚˜: <span id="pDice">ğŸ²</span> ì : <span id="eDice">ğŸ²</span>
</div>

<!-- ì• í”„í„° íŒ¨ë„ -->
<div id="after" style="display:none; margin-top:12px">
  <div style="margin-bottom:8px;font-weight:800">âœ… ì œì•• ì™„ë£Œ!</div>
  <div class="afterrow">
    <button id="btnRest" class="ok">ğŸ›€ ì”»ê³  ì¶œê·¼</button>
    <button id="btnBuyBag" class="ok">ğŸ’‰ êµ¬ê¸‰í•¨ (5ğŸ’°)</button>
    <button id="btnUseBagAfter" class="ok">ğŸ’‰ ì‚¬ìš© (â¤ï¸+30)</button>
    <button id="btnPromote" class="ok" title="ì—°ì°¨ ë„ë‹¬ ì‹œ í™œì„±í™”">ğŸ–ï¸ ìŠ¹ì§„ë„ì „ (10ğŸ’°)</button>
  </div>
</div>

<!-- ìŠ¹ì§„ ë„ì „ ëª¨ë‹¬ -->
<div id="promo" class="overlay">
  <div class="modal" style="max-width:680px;text-align:center">
    <div style="font-weight:800">ğŸ–ï¸ ìŠ¹ì§„ë„ì „</div>
    <div class="small" id="promoNeed" style="margin-top:6px">í•„ìš” ì ìˆ˜: 7 ì´ìƒ</div>
    <div style="margin-top:8px"><span id="pd1" style="font-size:92px">ğŸ²</span> <span id="pd2" style="font-size:92px">ğŸ²</span></div>
    <div id="presult" class="small" style="height:22px;margin-top:6px"></div>
    <div style="display:flex;justify-content:center;margin-top:8px;gap:8px">
      <button id="promoGo" class="ok">ğŸ² ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°</button>
      <button id="promoClose" class="pill" disabled>ë‹«ê¸°</button>
    </div>
  </div>
</div>

<!-- í† ìŠ¤íŠ¸ & ë””ì¡¸ë¸Œ -->
<div id="toast"><div class="bubble" id="toastMsg">ì•Œë¦¼</div></div>
<div id="diss"></div>

<script>
(()=>{
// ====== ìƒíƒœ & ìœ í‹¸ ======
const $=id=>document.getElementById(id);
const D=['âš€','âš','âš‚','âšƒ','âš„','âš…'];
const R=["ì˜ê²½","ìˆœê²½","ê²½ì¥","ê²½ì‚¬","ê²½ìœ„","ê²½ê°","ê²½ì •","ì´ê²½","ê²½ë¬´ê´€","ì¹˜ì•ˆê°","ì¹˜ì•ˆì •ê°","ì¹˜ì•ˆì´ê°"];
const rint=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;

const state={
  org:"police", gender:"M", name:"â€”",
  rankIdx:1, entryRank:"ìˆœê²½",
  maxHP:50, hp:50, gold:0, bags:0,
  level:1, enemyHP:0, enemyLabel:"",
  monthsAccum:0, rankMonths:Array(R.length).fill(0),  // ê³„ê¸‰ë³„ ëˆ„ì  ê°œì›”(ì˜ê²½ ë¶„ë¦¬)
  rolling:false, toasting:false, toastQ:[],
  promoLockedUntilNextAnniv:false
};

// ìš”êµ¬ì ìˆ˜ & ì—°ì°¨ ìµœì†Œê°œì›”(ê°„ë‹¨ ê·œì¹™)
const reqByRank=i=> i===0?6 : i<=3?7 : i<=6?8 : i<=9?9 : i===10?10 : 12;
const minMonths=i=> i===0?36 : i<=4?12 : i<=6?24 : i<=10?12 : 12; // ì˜ê²½ 3ë…„, ìˆœê²½~ê²½ìœ„ 1ë…„, ê²½ê°~ê²½ì • 2ë…„

const monthsInCurrentRank=()=>state.rankMonths[state.rankIdx];

// ====== í† ìŠ¤íŠ¸ í(2ì´ˆ) ======
function pushToast(msg){ state.toastQ.push(msg); runToast(); }
function runToast(){
  if(state.toasting || state.toastQ.length===0) return;
  state.toasting=true;
  const m=state.toastQ.shift();
  $("toastMsg").textContent=m; $("toast").style.display="block";
  setTimeout(()=>{ $("toast").style.display="none"; state.toasting=false; runToast(); }, 2000);
}

// ====== ì‹ ì› ì„ íƒ ======
const markActive=(cls,el)=>{ document.querySelectorAll('.'+cls).forEach(b=>b.classList.remove('active')); el.classList.add('active'); };
document.querySelectorAll('.selOrg').forEach(b=>b.addEventListener('click',()=>{state.org=b.dataset.val;markActive('selOrg',b);}));
document.querySelectorAll('.selGen').forEach(b=>b.addEventListener('click',()=>{state.gender=b.dataset.val;markActive('selGen',b);}));
document.querySelectorAll('.selRank').forEach(b=>b.addEventListener('click',()=>{state.rankIdx=parseInt(b.dataset.val,10); state.entryRank=R[state.rankIdx]; markActive('selRank',b);}));

$("btnStart").onclick=()=>{
  if(!document.querySelector('.selOrg.active')){ state.org=(rint(0,1)?'police':'coast'); }
  if(!document.querySelector('.selGen.active')){ state.gender=(rint(0,1)?'M':'F'); }
  if(!document.querySelector('.selRank.active')){ state.rankIdx=1; state.entryRank=R[1]; }
  state.name = ($("nm").value.trim() || (state.gender==='F'?'ë¯¼ê²½':'í¬ëŒ'));
  // ì´ˆê¸°í™”
  state.maxHP=50; state.hp=50; state.gold=0; state.bags=0;
  state.level=1; state.monthsAccum=0; state.rankMonths=Array(R.length).fill(0);
  $("start").style.display="none";
  spawn(); updateHUD();
};

// ====== ì „íˆ¬/ì  ======
function spawn(){ state.enemyLabel=`Lv.${state.level} ìš©ì˜ì`; state.enemyHP=15 + state.level*2; }
function updateHUD(){
  $("rank").textContent=R[state.rankIdx];
  $("name").textContent=state.name;
  $("emoji").textContent=state.gender==='F'?'ğŸ‘®â€â™€ï¸':'ğŸ‘®â€â™‚ï¸';
  $("orgBadge").textContent = state.org==='coast'?'ğŸš¤ í•´ì–‘ê²½ì°°':'ğŸš“ ê²½ì°°';
  $("hp").textContent=state.hp; $("maxhp").textContent=state.maxHP;
  $("gold").textContent=state.gold; $("bags").textContent=state.bags;
  $("enemyName").textContent=state.enemyLabel; $("enemyHP").textContent=state.enemyHP;
  $("reqLine").textContent=`ğŸ–ï¸ ${reqByRank(state.rankIdx)}ì  ì´ìƒì‹œ ìŠ¹ì§„! (ì—°ì°¨ ë„ë‹¬ ì‹œ)`;
  const inBattle = state.enemyHP>0 && $("after").style.display!=="block";
  ["btnRoll","btnBaton","btnFire","btnUseBag"].forEach(id=>$(id).disabled = !inBattle || state.rolling);
  // ìŠ¹ì§„ ë²„íŠ¼ í™œì„±í™” ì¡°ê±´(ì—°ì°¨ & ì ê¸ˆ í•´ì œ & ë¹„ìš©)
  const m=monthsInCurrentRank(); const okYear = m>=minMonths(state.rankIdx) && m%12===0;
  $("btnPromote").disabled = !(okYear && !state.promoLockedUntilNextAnniv && state.gold>=10);
}

// ì£¼ì‚¬ìœ„ ì• ë‹ˆë©”ì´ì…˜(0.5s)
function rollDiceAnim(done){
  if(state.rolling) return;
  state.rolling=true; updateHUD();
  let t=0; const iv=setInterval(()=>{
    $("pDice").textContent=D[rint(1,6)-1]; $("eDice").textContent=D[rint(1,6)-1];
    t+=80; if(t>=480){ clearInterval(iv); const p=rint(1,6), e=rint(1,6);
      $("pDice").textContent=D[p-1]; $("eDice").textContent=D[e-1];
      state.rolling=false; done(p,e);
    }
  },80);
}

// í•œ í„´ ì¢…ë£Œ ë’¤ ì²˜ë¦¬( + í† ìŠ¤íŠ¸ íëŠ” ì—¬ê¸°ì„œ )
function endTurnToasts({double2,bRes,fireRes,overforce,reward}){
  if(double2) pushToast(`ğŸ² ë”ë¸” ì—°ì†! +10ğŸ’°`);
  if(bRes)    pushToast(`ğŸ¦¯ ì‚¼ë‹¨ë´‰: ì£¼ì‚¬ìœ„ ${bRes.p} Ã—2 = ${bRes.dmg} í”¼í•´`);
  if(fireRes) pushToast(`ğŸ”« ê²©ë°œ: ${fireRes.msg}`);
  if(overforce) pushToast(`âš ï¸ ê³¼ì‰ì§„ì••! í˜ë„í‹° ì ìš©`);
  if(reward)  pushToast(`ğŸ… ì œì•• ë³´ìƒ: +${reward}ğŸ’°`);
}

// ì—”ë”©(3ì´ˆ ë””ì¡¸ë¸Œ)
function showEnding(text){
  const d=$("diss"); d.style.opacity=1; // 3s íŠ¸ëœì§€ì…˜
  setTimeout(()=>{
    alert(text); // ê°„ë‹¨ ì—”ë”© íŒ¨ë„(í•„ìš” ì‹œ ë³„ë„ ë ˆì´ì•„ì›ƒ êµì²´ ê°€ëŠ¥)
    d.style.opacity=0;
  },3000);
}

// ====== ë²„íŠ¼ ======
$("btnRoll").onclick=()=>{
  if(state.enemyHP<=0 || $("after").style.display==="block") return;
  rollDiceAnim((p,e)=>{
    const double2 = (D[p-1]===D[e-1]); // ê°„ë‹¨ ë”ë¸”åˆ¤ (ì—°ì†ì€ í•„ìš” ì‹œ ìƒíƒœí™•ì¥)
    state.enemyHP=Math.max(0,state.enemyHP-p);
    state.hp=Math.max(0,state.hp-e);
    let reward=0;
    if(state.enemyHP<=0){
      reward = 5 + state.level;
      state.gold += reward;
      // í† ìŠ¤íŠ¸ ë¨¼ì €(í„´ ì§í›„) â†’ ê·¸ë‹¤ìŒ ì• í”„í„° ì˜¤í”ˆ
      endTurnToasts({double2,reward});
      // ì• í”„í„° íŒ¨ë„ +4ê°œì›” ëˆ„ì 
      $("after").style.display="block";
      state.level++; // ë‹¤ìŒ ì  ë ˆë²¨(í‘œì‹œëŠ” ë‹¤ìŒ ì¶œê·¼ ì‹œ)
      state.monthsAccum+=4;
      state.rankMonths[state.rankIdx]+=4; // í˜„ ê³„ê¸‰ ê·¼ë¬´ ê°œì›” ì¦ê°€(ì˜ê²½ ë¶„ë¦¬)
    }else{
      endTurnToasts({double2});
    }
    updateHUD();
  });
};

$("btnBaton").onclick=()=>{
  if(state.enemyHP<=0) return; if(state.gold<1) return;
  state.gold--;
  rollDiceAnim((p,e)=>{
    const dmg=p*2;
    state.enemyHP=Math.max(0, state.enemyHP - dmg);
    state.hp=Math.max(0, state.hp - e);
    let reward=0;
    if(state.enemyHP<=0){
      reward = 5 + state.level;
      state.gold += reward;
      endTurnToasts({bRes:{p,dmg},reward});
      $("after").style.display="block";
      state.level++;
      state.monthsAccum+=4;
      state.rankMonths[state.rankIdx]+=4;
    }else{
      endTurnToasts({bRes:{p,dmg}});
    }
    updateHUD();
  });
};

$("btnUseBag").onclick=()=>{
  if(state.bags<=0 || state.hp===state.maxHP || state.enemyHP<=0) return;
  state.bags--; state.hp=Math.min(state.maxHP, state.hp+30);
  // í„´ ì†Œìš”: ì ë§Œ êµ´ë¦¼
  rollDiceAnim((_,e)=>{
    state.hp=Math.max(0,state.hp-e);
    updateHUD();
  });
};

$("btnRest").onclick=()=>{
  // ë‹¤ìŒ ì „íˆ¬ë¡œ
  $("after").style.display="none";
  state.enemyLabel=`Lv.${state.level} ìš©ì˜ì`; state.enemyHP=15 + state.level*2;
  updateHUD();
};
$("btnBuyBag").onclick=()=>{ if(state.gold>=5){ state.gold-=5; state.bags++; updateHUD(); } };
$("btnUseBagAfter").onclick=()=>{ if(state.bags>0 && state.hp<state.maxHP){ state.bags--; state.hp=Math.min(state.maxHP,state.hp+30); updateHUD(); } };

// ìŠ¹ì§„ë„ì „
$("btnPromote").onclick=()=>{
  const need=reqByRank(state.rankIdx);
  const m=monthsInCurrentRank();
  const okYear = m>=minMonths(state.rankIdx) && m%12===0;
  if(!okYear) return; if(state.gold<10) return;
  $("promo").style.display="flex";
  $("promoNeed").textContent=`í•„ìš” ì ìˆ˜: ${need} ì´ìƒ`;
  $("presult").textContent=""; $("promoClose").disabled=true;
  // 2ì´ˆ í›„ë¶€í„° ë‹«ê¸° ê°€ëŠ¥(ì§€ì‹œì‚¬í•­ 11)
  setTimeout(()=>{$("promoClose").disabled=false;},2000);

  $("promoGo").disabled=false;
  $("promoGo").onclick=()=>{
    $("promoGo").disabled=true;
    // ê°„ë‹¨ ì• ë‹ˆë©”ì´ì…˜ ëŒ€ì‹  ë°”ë¡œ ê²°ê³¼(ì›í•˜ë©´ 0.5s êµ´ë¦¼ ì¶”ê°€)
    const a=rint(1,6), b=rint(1,6), sum=a+b;
    $("pd1").textContent=D[a-1]; $("pd2").textContent=D[b-1];
    state.gold-=10;
    if(sum>=need){
      state.rankIdx=Math.min(R.length-1, state.rankIdx+1);
      state.maxHP+=10; state.hp=state.maxHP;
      state.rankMonths[state.rankIdx-1]=0; // ì´ì „ ê³„ê¸‰ ì¹´ìš´í„°ëŠ” ê·¸ëŒ€ë¡œ ë‘ê±°ë‚˜ ì´ˆê¸°í™” â€” ìŠ¹ì§„ í›„ í˜„ ê³„ê¸‰ ì¹´ìš´í„°ëŠ” 0
      // ìƒˆ ê³„ê¸‰ ì¹´ìš´í„° 0ìœ¼ë¡œ
      // (ë°°ì—´ì€ rankIdx ê¸°ì¤€ì´ë¼ ìŠ¹ì§„ í›„ ì¦ê°€ë¶„ì€ ì´í›„ ì „íˆ¬ì—ì„œ ë”í•´ì§)
      pushToast(`âœ… ìŠ¹ì§„ ì„±ê³µ! (í•„ìš” ${need}, ë‹¹ì‹  ${sum})`);
    }else{
      pushToast(`âŒ ìŠ¹ì§„ ì‹¤íŒ¨â€¦ (í•„ìš” ${need}, ë‹¹ì‹  ${sum})`);
    }
    // ì´ë²ˆ ì—°ì°¨ ì°½ì—ì„  ì¬ë„ì „ ë¶ˆê°€
    state.promoLockedUntilNextAnniv=true;
    updateHUD();
  };
};

$("promoClose").onclick=()=>{ $("promo").style.display="none"; };

// (ì˜ˆì‹œ) ì—”ë”© í˜¸ì¶œì´ í•„ìš”í•œ ìƒí™©ì—ì„œ
// showEnding("ëª…ì˜ˆí‡´ì§ ì—”ë”©");

// ì´ˆê¸°í™”
function firstSpawn(){ state.enemyLabel=`Lv.${state.level} ìš©ì˜ì`; state.enemyHP=15 + state.level*2; }
firstSpawn(); updateHUD();
})();
</script>
</body>
</html>
